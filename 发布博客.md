## templates/base.html修改
```
<ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li><a href="/" class="nav-link px-2 text-secondary" _msttexthash="2136498" _msthash="28">首页</a></li>
                <li><a href="{% url 'blog:pub_blog' %}" class="nav-link px-2 text-secondary" _msttexthash="5209451" _msthash="29">发布博客</a></li>
</ul>
```
## 在blog/views.py添加装饰器
```
@login_required()
def pub_blog(request):
    return render(request, 'pub_blog.html')
```
## 在django22/settings.py添加
```
LOGIN_URL = '/auth/login'
```
## 模型创建
修改blog/models.py
```
from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

# Create your models here.

class BlogCategory(models.Model):
    name = models.CharField(max_length=200)

class Blog(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    pub_time = models.DateTimeField(auto_now_add=True)
    category = models.ForeignKey(BlogCategory, on_delete=models.CASCADE)
    author = models.ForeignKey(User, on_delete=models.CASCADE)

class BlogComment(models.Model):
    content = models.TextField()
    pub_time = models.DateTimeField(auto_now_add=True)
    blog = models.ForeignKey(Blog, on_delete=models.CASCADE)
    author = models.ForeignKey(User, on_delete=models.CASCADE)
```
在终端输入
```
python manage.py makemigrations
python manage.py migrate
```
## admin系统使用
修改django22/settings.py的语言
```
LANGUAGE_CODE = 'zh-Hans' 
```
设置默认时区
```
TIME_ZONE = 'Asia/Shanghai'
USE_TZ = False
```
访问http://localhost:8000/admin/
修改blog/admin.py
```
from django.contrib import admin
from .models import BlogCategory,Blog,BlogComment

# Register your models here.

class BlogCategoryAdmin(admin.ModelAdmin):
    list_display = ['name']

class BlogAdmin(admin.ModelAdmin):
    list_display = ['title','content','pub_time','category','author']

class BlogCommentAdmin(admin.ModelAdmin):
    list_display = ['content','pub_time','author','blog']

admin.site.register(BlogCategory,BlogCategoryAdmin)
admin.site.register(Blog,BlogAdmin)
admin.site.register(BlogComment,BlogCommentAdmin)
```
修改blog/models.py，使其显示中文
```
from django.db import models
from django.contrib.auth import get_user_model

User = get_user_model()

# Create your models here.

class BlogCategory(models.Model):
    name = models.CharField(max_length=200, verbose_name='分类名称')

    def __str__(self):
        return self.name

    class Meta:
        verbose_name = '分类'
        verbose_name_plural = verbose_name

class Blog(models.Model):
    title = models.CharField(max_length=200,verbose_name='标题')
    content = models.TextField(verbose_name='内容')
    pub_time = models.DateTimeField(auto_now_add=True,verbose_name='发布时间')
    category = models.ForeignKey(BlogCategory, on_delete=models.CASCADE,verbose_name='分类')
    author = models.ForeignKey(User, on_delete=models.CASCADE,verbose_name='作者')

    def __str__(self):
        return self.title

    class Meta:
        verbose_name = '博客分类'
        verbose_name_plural = verbose_name

class BlogComment(models.Model):
    content = models.TextField(verbose_name='内容')
    pub_time = models.DateTimeField(auto_now_add=True,verbose_name='发布时间')
    blog = models.ForeignKey(Blog, on_delete=models.CASCADE,verbose_name='所属博客')
    author = models.ForeignKey(User, on_delete=models.CASCADE,verbose_name='作者')

    def __str__(self):
        return self.content

    class Meta:
        verbose_name = '评论'
        verbose_name_plural = verbose_name
```
再访问http://localhost:8000/admin/
<img width="1026" height="649" alt="image" src="https://github.com/user-attachments/assets/a5967458-9919-4ec3-a4a9-af878149d730" />
添加一些分类
<img width="1136" height="530" alt="image" src="https://github.com/user-attachments/assets/c6288fb7-db0e-4f28-92b7-b79ad1e3427c" />
新建一个blog/forms.py，内容如下
```
from django import forms

class PubBlogForm(forms.Form):
    title = forms.CharField(max_length=200,min_length=2)
    content = forms.CharField(min_length=2)
    category = forms.IntegerField()
```
修改blog/views.py的pub_blog类
```
@require_http_methods(['GET','POST'])
@login_required()
def pub_blog(request):
    if request.method == 'GET':
        categories = BlogCategory.objects.all()
        return render(request, 'pub_blog.html',context={'categories': categories})
    else:
        form = PubBlogForm(request.POST)
        if form.is_valid():
            title = form.cleaned_data('title')
            content = form.cleaned_data('content')
            category_id = form.cleaned_data('category')
            Blog.objects.create(title=title,content=content,category_id=category_id,author=request.user)
            return JsonResponse({"code":200,"message":"博客发布成功!"})
        else:
            print(form.errors)
            return JsonResponse({"code":400,"message":"参数错误!"})
```
修改templates/pub_blog.html的select显示
```
<div class="mb-3">
                <label class="form-label">分类</label>
                <select name="category" class="form-select">
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
</div>
```
